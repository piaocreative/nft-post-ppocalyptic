{"version":3,"file":"index.js","sources":["../src/index.tsx"],"sourcesContent":["import React, { useEffect, useRef } from \"react\";\n\ninterface TimelineObserverProps {\n  handleObserve?: (\n    observer: (target: Element, callbackFn?: () => void) => void\n  ) => JSX.Element;\n\n  initialColor?: string;\n  fillColor?: string;\n}\n\nconst halfScreenHeight = window.innerHeight / 2;\n\nconst options = {\n  root: null,\n  rootMargin: \"0px\",\n  threshold: 0.2,\n};\n\ninterface ObservablesProps {\n  observable: IntersectionObserverEntry;\n  isPassed: boolean;\n  callbackFn?: () => void;\n}\n\nfunction setObservable({ obs, observableList, callbacks }) {\n  const obsId = obs?.target?.id;\n\n  if (!observableList.has(obsId)) {\n    observableList.set(obsId, {\n      observable: obs,\n      isPassed: false,\n      callbackFn: callbacks[obsId] || null,\n    });\n  }\n}\n\nfunction removeObservable({ obs, observableList }) {\n  const obsName = obs?.target?.id;\n\n  if (observableList.has(obsName)) {\n    observableList.set(obsName, {\n      ...observableList.get(obsName),\n      isPassed: true,\n    });\n  }\n}\n\nfunction colorize(observableList, initialColor, fillColor) {\n  observableList.forEach((observable) => {\n    if (!observable.isPassed) {\n      const rect = observable.observable.target.getBoundingClientRect();\n      const entry = observable?.observable;\n\n      if (rect.bottom > halfScreenHeight && rect.top < halfScreenHeight) {\n        if (initialColor && fillColor) {\n          const depthPx = rect.bottom - halfScreenHeight;\n          const depthPercent = (depthPx * 100) / rect.height;\n          entry.target.style.background = `linear-gradient(to top, ${initialColor} ${depthPercent}%, ${fillColor} ${depthPercent}% 100%)`;\n          entry.target.style.transform = \"translateZ(0)\";\n        }\n      }\n      if (rect.bottom < halfScreenHeight) {\n        if (initialColor && fillColor) {\n          entry.target.style.background = fillColor;\n          entry.target.style.transform = \"unset\";\n        }\n\n        if (observable?.callbackFn) {\n          observable?.callbackFn();\n        }\n\n        removeObservable({\n          obs: entry,\n          observableList,\n        });\n      }\n    }\n  });\n}\n\nconst TimelineObserver = ({\n  handleObserve,\n  initialColor,\n  fillColor,\n}: TimelineObserverProps) => {\n  const observablesStore = useRef(new Map<string, ObservablesProps>());\n  const callbacks = useRef<{ [key: string]: () => void }>({});\n\n  const callback = (entries) => {\n    entries?.forEach((entry) => {\n      if (entry.isIntersecting) {\n        setObservable({\n          obs: entry,\n          observableList: observablesStore.current,\n          callbacks: callbacks.current,\n        });\n      }\n    });\n  };\n  const observer = useRef(new IntersectionObserver(callback, options));\n\n  const animation = () => {\n    window.requestAnimationFrame(() => {\n      colorize(observablesStore.current, initialColor, fillColor);\n    });\n  };\n\n  useEffect(() => {\n    document.addEventListener(\"scroll\", animation);\n    return () => {\n      document.removeEventListener(\"scroll\", animation);\n    };\n  }, []);\n\n  const setObserver = (elem: HTMLElement, callbackFn?: () => void) => {\n    const elemId = elem?.id;\n\n    if (initialColor) {\n      elem.style.background = initialColor;\n    }\n\n    observer.current.observe(elem);\n\n    if (elemId && callbackFn) {\n      callbacks.current[elemId] = callbackFn;\n    }\n  };\n\n  return <div>{handleObserve ? handleObserve(setObserver) : null}</div>;\n};\n\nexport default TimelineObserver;\n"],"names":["useRef","useEffect","React"],"mappings":"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"}